{% extends 'video_upload/layout.html' %}
{% load crispy_forms_tags %}
{% block content %}
{% if user.is_authenticated%}

<div class="col-12">
    <div class="section-header">
        <h3>Upload</h3>
    </div>
    <div class="section-body">
        {% block main %}
        <form method="post" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-row">
                <div class="form-group col">
                    {{ form.document|as_crispy_field }}
                </div>
                <div class="form-group col">
                    {{ form.tv|as_crispy_field }}
                    <button type="submit" class="btn btn-primary"><i class="fas fa-upload"></i>Upload</button>
                </div>
            </div>
        </form>
        {% endblock %}
    </div>
</div>


</div>

<div class="row">

    <div class="col-3">

        <div class="section-header">
            <h3>Status</h3>
        </div>
        <div id="status" class="section-body">
            {% for response in responses %}
            <p>{{response.1}}</p> {# tv name #}
            {% if response.2 == 0 %} {# tv status #}
            <i class="fa fa-power-off online"></i>
            {% else %}
            <i class="fa fa-power-off offline"></i>
            {% endif %}
            {% with tv_name=response.1 %}
            <span onclick="preview_video('{{ tv_name }}')" class="fa fa-play-circle"></span> <br>
            {% endwith %}
            {% endfor %}
        </div>

    </div>

    <div class="col-9">
        <div class="section-header">
            <h3>Preview</h3>
        </div>
        <div class="section-body">
            <video id="tv_video" controls autoplay loop>
                <source id="player" src="" type="video/mp4" />
                video not supported by this browser.
            </video>
        </div>
    </div>

    <script>
        function preview_video(video) {
            document.getElementById('tv_video').src = "../../media/videos/" + video + ".mp4";
            console.log("playing", document.getElementById('tv_video').src);
        }
    </script>

    {% else %}
    <script>
        window.location.href = "../accounts/login/"
    </script>
    {% endif %}
    {% endblock %}